const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-p3_BIcIq.js","assets/index-BRaaWty1.js","assets/index-DhdIiN55.css"])))=>i.map(i=>d[i]);
import{c as W,j as s,v as se,w as ie,B as S,K as T,N as $,H as oe,r as x,_ as ce,U as B,a1 as y,V,W as q,Y as G,Z as J,$ as Z,a0 as Q,J as le}from"./index-BRaaWty1.js";import{U as he}from"./upload-CEIhjUlp.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]],L=W("crop",de);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],me=W("rotate-cw",pe);function ge({isOcrCameraActive:d,isProcessingImage:e,ocrCameraError:t,cameraPermission:i,showOcrCameraPrompt:a,fileInputRef:r,ocrVideoRef:c,ocrCanvasRef:p,ingredients:o,activeTab:n,onIngredientsChange:h,captureForOcr:m,stopOcrCamera:g,handleImageUpload:l}){return s.jsxs("div",{className:"space-y-4",children:[t&&s.jsx(se,{variant:"destructive",children:s.jsx(ie,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"whitespace-pre-line",children:t}),i==="denied"&&s.jsx(S,{variant:"outline",size:"sm",onClick:a,className:"w-full",children:"Try Camera Again"})]})})}),d?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"relative max-w-md mx-auto",children:[s.jsx("video",{ref:c,className:"w-full rounded-lg border",autoPlay:!0,playsInline:!0,muted:!0}),s.jsx("canvas",{ref:p,className:"hidden"})]}),s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsxs(S,{onClick:m,disabled:e,className:"flex items-center gap-2",children:[s.jsx(T,{className:"h-4 w-4"}),"Capture & Crop"]}),s.jsx(S,{variant:"outline",onClick:g,disabled:e,children:"Cancel"})]}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Capture the label, crop to the ingredient list, and we'll run OCR on the selected area."})]}):s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[s.jsxs(S,{variant:"outline",onClick:a,disabled:e,className:"flex items-center gap-2",children:[s.jsx(T,{className:"h-4 w-4"}),"Take Photo"]}),s.jsxs(S,{variant:"outline",onClick:()=>r.current?.click(),disabled:e,className:"flex items-center gap-2",children:[s.jsx(he,{className:"h-4 w-4"}),"Upload Image"]})]}),s.jsx("input",{type:"file",ref:r,onChange:l,accept:"image/*",className:"hidden"}),e&&s.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[s.jsx($,{className:"h-4 w-4 animate-spin"}),s.jsx("p",{children:"Processing image with OCR..."}),s.jsx("p",{className:"text-sm",children:"This may take a few seconds"})]}),s.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[s.jsx("p",{children:"• Supported formats: JPG, PNG, GIF, WebP"}),s.jsx("p",{children:"• Maximum file size: 10MB"}),s.jsx("p",{children:"• Works best with high-contrast text"}),s.jsx("p",{children:"• Hold camera steady for best results"})]}),o&&n==="ocr"&&s.jsxs("div",{className:"mt-4 text-left",children:[s.jsx("label",{className:"block mb-2",children:"Extracted Text (edit if needed):"}),s.jsx(oe,{value:o,onChange:C=>h(C.target.value),rows:4,className:"w-full",placeholder:"Extracted ingredients will appear here..."}),s.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Please review and edit the extracted text to ensure accuracy before analysis"})]})]})}function ue({onTextExtracted:d,onPermissionChange:e}){const[t,i]=x.useState(!1),[a,r]=x.useState(!1),[c,p]=x.useState(null),[o,n]=x.useState(!1),[h,m]=x.useState(null),[g,l]=x.useState(!1),[C,b]=x.useState(null),[v,u]=x.useState(null),R=x.useRef(null),N=x.useRef(null),M=x.useCallback(async w=>{i(!0);try{const f=await ce(()=>import("./index-p3_BIcIq.js").then(k=>k.i),__vite__mapDeps([0,1,2])),{data:{text:D}}=await f.recognize(w,"eng",{logger:k=>{k?.status==="recognizing text"&&console.log(`OCR Progress: ${Math.round((k.progress??0)*100)}%`)}}),j=D.replace(/\s+/g," ").replace(/[^\w\s,.-]/g,"").trim();if(!j)throw new Error("No text found in image. Please try a clearer image.");return j}catch(f){throw console.error("OCR Error:",f),new Error(f?.message||"Failed to extract text from image")}finally{i(!1)}},[]),Y=x.useCallback(w=>new Promise((f,D)=>{const j=new FileReader;j.onload=()=>f(j.result),j.onerror=()=>D(new Error("Failed to read file")),j.readAsDataURL(w)}),[]),O=x.useCallback(()=>{v&&(v.getTracks().forEach(w=>w.stop()),u(null)),r(!1),p(null)},[v]),I=x.useCallback((w,f)=>{m(w),b(f),l(!0)},[]),ee=x.useCallback(()=>{const w=C;l(!1),m(null),b(null),w==="camera"&&n(!0)},[C]),te=x.useCallback(async w=>{const f=C;try{const D=new File([w],"cropped-image.jpg",{type:w.type||"image/jpeg"}),j=await M(D);d(j),l(!1),m(null),b(null),f==="camera"&&O()}catch(D){console.error("Crop processing failed:",D),B.error(D?.message||"Failed to process the cropped image. Please try again.")}},[M,d,C,O]),ae=x.useCallback(async w=>{const f=w.target.files?.[0];if(f){if(!f.type.startsWith("image/")){B.error("Please select a valid image file."),w.target.value="";return}if(f.size>10*1024*1024){B.error("Image file is too large. Please select an image smaller than 10MB."),w.target.value="";return}try{const D=await Y(f);I(D,"upload")}catch(D){console.error("Image preview error:",D),B.error(D?.message||"Unable to prepare the image for cropping.")}finally{w.target.value=""}}},[Y,I]),re=x.useCallback(async()=>{p(null),r(!0),n(!1);try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera not supported on this device or browser. Please try uploading an image instead.");if(location.protocol!=="https:"&&location.hostname!=="localhost")throw new Error("Camera access requires a secure connection (HTTPS). Please try uploading an image instead.");const w={video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}};console.log("Requesting camera access for OCR...");const f=await navigator.mediaDevices.getUserMedia(w);u(f),e?.("granted");const D=R.current;D&&(D.srcObject=f,await D.play()),console.log("OCR Camera access granted successfully")}catch(w){console.error("OCR Camera access error:",w),r(!1);let f="";w.name==="NotAllowedError"?(e?.("denied"),f=`Camera access was denied. To use the camera feature:

1. Click "Allow" when your browser asks for camera permission
2. If you accidentally clicked "Block", click the camera icon in your address bar and select "Allow"
3. You can also try refreshing the page and trying again

Alternatively, you can upload an image instead.`):w.name==="NotFoundError"?f="No camera found on this device. Please try uploading an image instead.":w.name==="NotSupportedError"?f="Camera not supported on this device or browser. Please try uploading an image instead.":w.name==="NotReadableError"?f="Camera is already in use by another application. Please close other apps using the camera and try again.":f=w.message||"An unknown error occurred. Please try uploading an image instead.",p(f)}},[e]),ne=x.useCallback(async()=>{const w=R.current,f=N.current;if(!w||!f)return;const D=f.getContext("2d");if(!D){console.error("Camera capture error: Unable to access drawing context"),p("Could not capture from camera. Please try again.");return}let j=w.videoWidth,k=w.videoHeight;if(!j||!k){const P=v?.getVideoTracks()?.[0]?.getSettings();j=P?.width??j,k=P?.height??k}if(!j||!k){const P=w.getBoundingClientRect();j=Math.round(P.width),k=Math.round(P.height)}if(!j||!k){console.warn("Camera capture warning: Frame dimensions not ready"),p("Camera feed is still loading. Hold steady for a moment and try capturing again.");return}f.width=j,f.height=k,D.drawImage(w,0,0,j,k);try{const P=f.toDataURL("image/jpeg",.95);if(!P||P==="data:"||P.length<100)throw new Error("Camera produced an empty frame");I(P,"camera"),O()}catch(P){console.error("Camera capture error:",P),p(P?.message||"Failed to capture image. Please try again.")}},[v,I,O]);return x.useEffect(()=>()=>{v&&v.getTracks().forEach(w=>w.stop())},[v]),{ocrVideoRef:R,ocrCanvasRef:N,isProcessingImage:t,isOcrCameraActive:a,ocrCameraError:c,showOcrCameraPrompt:o,setShowOcrCameraPrompt:n,croppingImage:h,isCropDialogOpen:g,startOcrCamera:re,stopOcrCamera:O,captureForOcr:ne,handleImageUpload:ae,handleCropComplete:te,handleCropCancel:ee}}const K={x:0,y:0,width:0,height:0,unit:"px"},A=(d,e,t)=>Math.min(Math.max(d,e),t),we=(...d)=>d.filter(e=>e&&typeof e=="string").join(" "),F=(d,e)=>d===e||d.width===e.width&&d.height===e.height&&d.x===e.x&&d.y===e.y&&d.unit===e.unit;function X(d,e,t){return d.unit==="%"?{...K,...d,unit:"%"}:{unit:"%",x:d.x?d.x/e*100:0,y:d.y?d.y/t*100:0,width:d.width?d.width/e*100:0,height:d.height?d.height/t*100:0}}function H(d,e,t){return d.unit?d.unit==="px"?{...K,...d,unit:"px"}:{unit:"px",x:d.x?d.x*e/100:0,y:d.y?d.y*t/100:0,width:d.width?d.width*e/100:0,height:d.height?d.height*t/100:0}:{...K,...d,unit:"px"}}function z(d,e,t,i,a,r=0,c=0,p=i,o=a){const n={...d};let h=Math.min(r,i),m=Math.min(c,a),g=Math.min(p,i),l=Math.min(o,a);e&&(e>1?(h=c?c*e:h,m=h/e,g=p*e):(m=r?r/e:m,h=m*e,l=o/e)),n.y<0&&(n.height=Math.max(n.height+n.y,m),n.y=0),n.x<0&&(n.width=Math.max(n.width+n.x,h),n.x=0);const C=i-(n.x+n.width);C<0&&(n.x=Math.min(n.x,i-h),n.width+=C);const b=a-(n.y+n.height);if(b<0&&(n.y=Math.min(n.y,a-m),n.height+=b),n.width<h&&((t==="sw"||t=="nw")&&(n.x-=h-n.width),n.width=h),n.height<m&&((t==="nw"||t=="ne")&&(n.y-=m-n.height),n.height=m),n.width>g&&((t==="sw"||t=="nw")&&(n.x-=g-n.width),n.width=g),n.height>l&&((t==="nw"||t=="ne")&&(n.y-=l-n.height),n.height=l),e){const v=n.width/n.height;if(v<e){const u=Math.max(n.width/e,m);(t==="nw"||t=="ne")&&(n.y-=u-n.height),n.height=u}else if(v>e){const u=Math.max(n.height*e,h);(t==="sw"||t=="nw")&&(n.x-=u-n.width),n.width=u}}return n}function xe(d,e,t,i){const a={...d};return e==="ArrowLeft"?i==="nw"?(a.x-=t,a.y-=t,a.width+=t,a.height+=t):i==="w"?(a.x-=t,a.width+=t):i==="sw"?(a.x-=t,a.width+=t,a.height+=t):i==="ne"?(a.y+=t,a.width-=t,a.height-=t):i==="e"?a.width-=t:i==="se"&&(a.width-=t,a.height-=t):e==="ArrowRight"&&(i==="nw"?(a.x+=t,a.y+=t,a.width-=t,a.height-=t):i==="w"?(a.x+=t,a.width-=t):i==="sw"?(a.x+=t,a.width-=t,a.height-=t):i==="ne"?(a.y-=t,a.width+=t,a.height+=t):i==="e"?a.width+=t:i==="se"&&(a.width+=t,a.height+=t)),e==="ArrowUp"?i==="nw"?(a.x-=t,a.y-=t,a.width+=t,a.height+=t):i==="n"?(a.y-=t,a.height+=t):i==="ne"?(a.y-=t,a.width+=t,a.height+=t):i==="sw"?(a.x+=t,a.width-=t,a.height-=t):i==="s"?a.height-=t:i==="se"&&(a.width-=t,a.height-=t):e==="ArrowDown"&&(i==="nw"?(a.x+=t,a.y+=t,a.width-=t,a.height-=t):i==="n"?(a.y+=t,a.height-=t):i==="ne"?(a.y+=t,a.width-=t,a.height-=t):i==="sw"?(a.x-=t,a.width+=t,a.height+=t):i==="s"?a.height+=t:i==="se"&&(a.width+=t,a.height+=t)),a}const U={capture:!0,passive:!1},_=class E extends x.PureComponent{constructor(){super(...arguments),this.docMoveBound=!1,this.mouseDownOnCrop=!1,this.dragStarted=!1,this.evData={startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0},this.componentRef=x.createRef(),this.mediaRef=x.createRef(),this.initChangeCalled=!1,this.state={cropIsActive:!1,newCropIsBeingDrawn:!1},this.onCropPointerDown=e=>{const{crop:t,disabled:i}=this.props,a=this.getBox();if(!t)return;const r=H(t,a.width,a.height);if(i)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const c=e.target.dataset.ord,p=!!c;let o=e.clientX,n=e.clientY,h=r.x,m=r.y;if(c){const g=e.clientX-a.x,l=e.clientY-a.y;let C=0,b=0;c==="ne"||c=="e"?(C=g-(r.x+r.width),b=l-r.y,h=r.x,m=r.y+r.height):c==="se"||c==="s"?(C=g-(r.x+r.width),b=l-(r.y+r.height),h=r.x,m=r.y):c==="sw"||c=="w"?(C=g-r.x,b=l-(r.y+r.height),h=r.x+r.width,m=r.y):(c==="nw"||c=="n")&&(C=g-r.x,b=l-r.y,h=r.x+r.width,m=r.y+r.height),o=h+a.x+C,n=m+a.y+b}this.evData={startClientX:o,startClientY:n,startCropX:h,startCropY:m,clientX:e.clientX,clientY:e.clientY,isResize:p,ord:c},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})},this.onComponentPointerDown=e=>{const{crop:t,disabled:i,locked:a,keepSelection:r,onChange:c}=this.props,p=this.getBox();if(i||a||r&&t)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const o=e.clientX-p.x,n=e.clientY-p.y,h={unit:"px",x:o,y:n,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:o,startCropY:n,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,c(H(h,p.width,p.height),X(h,p.width,p.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})},this.onDocPointerMove=e=>{const{crop:t,disabled:i,onChange:a,onDragStart:r}=this.props,c=this.getBox();if(i||!t||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,r&&r(e));const{evData:p}=this;p.clientX=e.clientX,p.clientY=e.clientY;let o;p.isResize?o=this.resizeCrop():o=this.dragCrop(),F(t,o)||a(H(o,c.width,c.height),X(o,c.width,c.height))},this.onComponentKeyDown=e=>{const{crop:t,disabled:i,onChange:a,onComplete:r}=this.props;if(i)return;const c=e.key;let p=!1;if(!t)return;const o=this.getBox(),n=this.makePixelCrop(o),h=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?E.nudgeStepLarge:e.shiftKey?E.nudgeStepMedium:E.nudgeStep;if(c==="ArrowLeft"?(n.x-=h,p=!0):c==="ArrowRight"?(n.x+=h,p=!0):c==="ArrowUp"?(n.y-=h,p=!0):c==="ArrowDown"&&(n.y+=h,p=!0),p){e.cancelable&&e.preventDefault(),n.x=A(n.x,0,o.width-n.width),n.y=A(n.y,0,o.height-n.height);const m=H(n,o.width,o.height),g=X(n,o.width,o.height);a(m,g),r&&r(m,g)}},this.onHandlerKeyDown=(e,t)=>{const{aspect:i=0,crop:a,disabled:r,minWidth:c=0,minHeight:p=0,maxWidth:o,maxHeight:n,onChange:h,onComplete:m}=this.props,g=this.getBox();if(r||!a)return;if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")e.stopPropagation(),e.preventDefault();else return;const l=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?E.nudgeStepLarge:e.shiftKey?E.nudgeStepMedium:E.nudgeStep,C=H(a,g.width,g.height),b=xe(C,e.key,l,t),v=z(b,i,t,g.width,g.height,c,p,o,n);if(!F(a,v)){const u=X(v,g.width,g.height);h(v,u),m&&m(v,u)}},this.onDocPointerDone=e=>{const{crop:t,disabled:i,onComplete:a,onDragEnd:r}=this.props,c=this.getBox();this.unbindDocMove(),!(i||!t)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,r&&r(e),a&&a(H(t,c.width,c.height),X(t,c.width,c.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))},this.onDragFocus=e=>{var t;(t=this.componentRef.current)==null||t.scrollTo(0,0)}}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:t,y:i,width:a,height:r}=e.getBoundingClientRect();return{x:t,y:i,width:a,height:r}}componentDidUpdate(e){const{crop:t,onComplete:i}=this.props;if(i&&!e.crop&&t){const{width:a,height:r}=this.getBox();a&&r&&i(H(t,a,r),X(t,a,r))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,U),this.document.addEventListener("pointerup",this.onDocPointerDone,U),this.document.addEventListener("pointercancel",this.onDocPointerDone,U),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,U),this.document.removeEventListener("pointerup",this.onDocPointerDone,U),this.document.removeEventListener("pointercancel",this.onDocPointerDone,U),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,t=this.getBox(),i=this.makePixelCrop(t),a=e.clientX-e.startClientX,r=e.clientY-e.startClientY;return i.x=A(e.startCropX+a,0,t.width-i.width),i.y=A(e.startCropY+r,0,t.height-i.height),i}getPointRegion(e,t,i,a){const{evData:r}=this,c=r.clientX-e.x,p=r.clientY-e.y;let o;a&&t?o=t==="nw"||t==="n"||t==="ne":o=p<r.startCropY;let n;return i&&t?n=t==="nw"||t==="w"||t==="sw":n=c<r.startCropX,n?o?"nw":"sw":o?"ne":"se"}resolveMinDimensions(e,t,i=0,a=0){let r=Math.min(i,e.width),c=Math.min(a,e.height);return!t||!r&&!c?[r,c]:t>1?r?[r,r/t]:[c*t,c]:c?[c*t,c]:[r,r/t]}resizeCrop(){const{evData:e}=this,{aspect:t=0,maxWidth:i,maxHeight:a}=this.props,r=this.getBox(),[c,p]=this.resolveMinDimensions(r,t,this.props.minWidth,this.props.minHeight);let o=this.makePixelCrop(r),n=this.getPointRegion(r,e.ord,c,p);const h=e.ord||n;let m=e.clientX-e.startClientX,g=e.clientY-e.startClientY;(c&&h==="nw"||h==="w"||h==="sw")&&(m=Math.min(m,-c)),(p&&h==="nw"||h==="n"||h==="ne")&&(g=Math.min(g,-p));const l={unit:"px",x:0,y:0,width:0,height:0};n==="ne"?(l.x=e.startCropX,l.width=m,t?(l.height=l.width/t,l.y=e.startCropY-l.height):(l.height=Math.abs(g),l.y=e.startCropY-l.height)):n==="se"?(l.x=e.startCropX,l.y=e.startCropY,l.width=m,t?l.height=l.width/t:l.height=g):n==="sw"?(l.x=e.startCropX+m,l.y=e.startCropY,l.width=Math.abs(m),t?l.height=l.width/t:l.height=g):n==="nw"&&(l.x=e.startCropX+m,l.width=Math.abs(m),t?(l.height=l.width/t,l.y=e.startCropY-l.height):(l.height=Math.abs(g),l.y=e.startCropY+g));const C=z(l,t,n,r.width,r.height,c,p,i,a);return t||E.xyOrds.indexOf(h)>-1?o=C:E.xOrds.indexOf(h)>-1?(o.x=C.x,o.width=C.width):E.yOrds.indexOf(h)>-1&&(o.y=C.y,o.height=C.height),o.x=A(o.x,0,r.width-o.width),o.y=A(o.y,0,r.height-o.height),o}createCropSelection(){const{ariaLabels:e=E.defaultProps.ariaLabels,disabled:t,locked:i,renderSelectionAddon:a,ruleOfThirds:r,crop:c}=this.props,p=this.getCropStyle();if(c)return y.createElement("div",{style:p,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":e.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!t&&!i&&y.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},y.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),y.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),y.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),y.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":e.nwDragHandle,onKeyDown:o=>this.onHandlerKeyDown(o,"nw"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":e.nDragHandle,onKeyDown:o=>this.onHandlerKeyDown(o,"n"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":e.neDragHandle,onKeyDown:o=>this.onHandlerKeyDown(o,"ne"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":e.eDragHandle,onKeyDown:o=>this.onHandlerKeyDown(o,"e"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":e.seDragHandle,onKeyDown:o=>this.onHandlerKeyDown(o,"se"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":e.sDragHandle,onKeyDown:o=>this.onHandlerKeyDown(o,"s"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":e.swDragHandle,onKeyDown:o=>this.onHandlerKeyDown(o,"sw"),role:"button"}),y.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":e.wDragHandle,onKeyDown:o=>this.onHandlerKeyDown(o,"w"),role:"button"})),a&&y.createElement("div",{className:"ReactCrop__selection-addon",onMouseDown:o=>o.stopPropagation()},a(this.state)),r&&y.createElement(y.Fragment,null,y.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),y.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){const t={...K,...this.props.crop||{}};return H(t,e.width,e.height)}render(){const{aspect:e,children:t,circularCrop:i,className:a,crop:r,disabled:c,locked:p,style:o,ruleOfThirds:n}=this.props,{cropIsActive:h,newCropIsBeingDrawn:m}=this.state,g=r?this.createCropSelection():null,l=we("ReactCrop",a,h&&"ReactCrop--active",c&&"ReactCrop--disabled",p&&"ReactCrop--locked",m&&"ReactCrop--new-crop",r&&e&&"ReactCrop--fixed-aspect",r&&i&&"ReactCrop--circular-crop",r&&n&&"ReactCrop--rule-of-thirds",!this.dragStarted&&r&&!r.width&&!r.height&&"ReactCrop--invisible-crop",i&&"ReactCrop--no-animate");return y.createElement("div",{ref:this.componentRef,className:l,style:o},y.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),g)}};_.xOrds=["e","w"];_.yOrds=["n","s"];_.xyOrds=["nw","ne","se","sw"];_.nudgeStep=1;_.nudgeStepMedium=10;_.nudgeStepLarge=100;_.defaultProps={ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}};let fe=_;function Ce({isOpen:d,imageSrc:e,onCropComplete:t,onCancel:i}){const[a,r]=x.useState({unit:"%",x:10,y:10,width:80,height:80}),[c,p]=x.useState(null),[o,n]=x.useState(!1),[h,m]=x.useState(0),g=x.useRef(null),l=x.useRef(null);x.useEffect(()=>{d&&(r({unit:"%",x:10,y:10,width:80,height:80}),p(null),m(0))},[d,e]);const C=()=>{m(u=>(u+90)%360)},b=async()=>{if(!c||!g.current||!l.current)return null;const u=l.current,R=g.current,N=u.getContext("2d");if(!N)return null;const M=R.naturalWidth/R.width,Y=R.naturalHeight/R.height;if(u.width=c.width*M,u.height=c.height*Y,h!==0){const O=u.width/2,I=u.height/2;N.save(),N.translate(O,I),N.rotate(h*Math.PI/180),N.translate(-O,-I)}return N.drawImage(R,c.x*M,c.y*Y,c.width*M,c.height*Y,0,0,u.width,u.height),h!==0&&N.restore(),new Promise(O=>{u.toBlob(I=>{O(I||null)},"image/jpeg",.95)})},v=async()=>{n(!0);try{const u=await b();u?t(u):console.error("Failed to create cropped image")}catch(u){console.error("Error cropping image:",u)}finally{n(!1)}};return s.jsx(V,{open:d,onOpenChange:u=>!u&&i(),children:s.jsxs(q,{className:"w-[calc(100vw-1.5rem)] max-w-[min(420px,100vw-1.5rem)] sm:max-w-3xl max-h-[90vh] overflow-hidden p-0 sm:p-0 flex flex-col",children:[s.jsxs(G,{className:"px-4 pt-4 sm:px-6 sm:pt-6",children:[s.jsxs(J,{className:"flex items-center gap-2 text-lg sm:text-xl",children:[s.jsx(L,{className:"h-5 w-5"}),"Crop Ingredient Label"]}),s.jsx(Z,{asChild:!0,children:s.jsx("div",{className:"text-sm sm:text-base text-muted-foreground",children:"Adjust the crop area to include only the ingredient list for better results."})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-4 sm:px-6 sm:pb-6",children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:s.jsxs(S,{variant:"outline",size:"sm",onClick:C,className:"flex w-full max-w-[220px] items-center justify-center gap-2 sm:w-auto",children:[s.jsx(me,{className:"h-4 w-4"}),"Rotate 90°"]})}),s.jsx("div",{className:"flex justify-center items-center bg-muted/30 rounded-lg p-3 sm:p-4 min-h-[240px] sm:min-h-[300px]",children:s.jsx(fe,{crop:a,onChange:u=>r(u),onComplete:u=>p(u),className:"max-w-full flex-1",children:s.jsx("img",{ref:g,src:e,alt:"Crop preview",className:"max-h-[60vh] w-full object-contain",style:{transform:`rotate(${h}deg)`,transition:"transform 0.3s ease"},onLoad:u=>{const R=u.currentTarget,N=R.width,M=R.height;r({unit:"px",x:N*.1,y:M*.1,width:N*.8,height:M*.8})}})})}),s.jsx("canvas",{ref:l,className:"hidden"})]})}),s.jsxs(Q,{className:"flex-col sm:flex-row gap-2 px-4 pb-4 sm:px-6 sm:pb-6",children:[s.jsx(S,{variant:"outline",onClick:i,disabled:o,children:"Cancel"}),s.jsx(S,{onClick:v,disabled:o||!c,className:"flex w-full items-center justify-center gap-2 sm:w-auto",children:o?s.jsxs(s.Fragment,{children:[s.jsx($,{className:"h-4 w-4 animate-spin"}),"Processing..."]}):s.jsxs(s.Fragment,{children:[s.jsx(L,{className:"h-4 w-4"}),"Crop & Process"]})})]})]})})}function De({ingredients:d,onIngredientsChange:e}){const[t,i]=x.useState("unknown"),a=x.useRef(null),{ocrVideoRef:r,ocrCanvasRef:c,isProcessingImage:p,isOcrCameraActive:o,ocrCameraError:n,showOcrCameraPrompt:h,setShowOcrCameraPrompt:m,croppingImage:g,isCropDialogOpen:l,startOcrCamera:C,stopOcrCamera:b,captureForOcr:v,handleImageUpload:u,handleCropComplete:R,handleCropCancel:N}=ue({onTextExtracted:e,onPermissionChange:i}),M=x.useMemo(()=>typeof navigator<"u"&&!!navigator.mediaDevices,[]);return s.jsxs("div",{className:"space-y-4",children:[s.jsx(ge,{isOcrCameraActive:o,isProcessingImage:p,ocrCameraError:n,cameraPermission:t,showOcrCameraPrompt:()=>m(!0),fileInputRef:a,ocrVideoRef:r,ocrCanvasRef:c,ingredients:d,activeTab:"ocr",onIngredientsChange:e,captureForOcr:v,stopOcrCamera:b,handleImageUpload:u}),g&&s.jsx(Ce,{isOpen:l,imageSrc:g,onCropComplete:R,onCancel:N}),s.jsx(V,{open:h,onOpenChange:m,children:s.jsxs(q,{className:"sm:max-w-md",children:[s.jsxs(G,{children:[s.jsxs(J,{className:"flex items-center gap-2",children:[s.jsx(T,{className:"h-5 w-5"}),"Camera Access Required"]}),s.jsx(Z,{asChild:!0,children:s.jsxs("div",{className:"space-y-3 text-left",children:[s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(le,{className:"h-4 w-4 mt-0.5 text-blue-500 flex-shrink-0"}),s.jsx("span",{children:"This app needs access to your camera to capture ingredient labels for text extraction."})]}),s.jsxs("div",{className:"bg-muted p-3 rounded-lg text-sm",children:[s.jsx("div",{className:"font-medium mb-2",children:"What will happen next:"}),s.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[s.jsx("li",{children:"Your browser will ask for camera permission"}),s.jsx("li",{children:'Click "Allow" to enable the camera'}),s.jsx("li",{children:"Position the ingredient list in the camera view"}),s.jsx("li",{children:"Capture and process the image"})]})]}),s.jsx("div",{className:"text-xs text-muted-foreground",children:"Your privacy is protected - images are processed locally and never stored on our servers."})]})})]}),s.jsxs(Q,{className:"flex gap-2 sm:justify-between",children:[s.jsx(S,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),s.jsx(S,{onClick:()=>{m(!1),C()},disabled:!M,children:"Enable Camera"})]})]})})]})}export{De as OcrCaptureSection};
